Dưới đây là nội dung chi tiết cho bài học:

---

# 04. CSRF (Cross-Site Request Forgery)

**Tấn công giả mạo yêu cầu từ trình duyệt**

---

## 🎯 Mục tiêu

* Hiểu bản chất của CSRF và cách nó khai thác trình duyệt.
* Biết các tình huống tấn công điển hình và hậu quả.
* Nắm các kỹ thuật phòng chống CSRF hiệu quả.

> CSRF đánh lừa trình duyệt thực hiện hành động trái phép thay mặt người dùng đã đăng nhập.

---

## 📌 1. CSRF là gì?

CSRF (Cross-Site Request Forgery) là tấn công ép trình duyệt của người dùng **đã đăng nhập** gửi yêu cầu đến một trang web khác mà người dùng có quyền, mà **không biết**.

Ví dụ: khi người dùng đang đăng nhập vào tài khoản ngân hàng, kẻ tấn công khiến trình duyệt gửi lệnh chuyển tiền qua một website trung gian.

---

## 💣 2. Ví dụ minh họa

### 🔹 Tình huống:

Bạn đã đăng nhập vào trang:

```
http://bank.com
```

Kẻ tấn công gửi email chứa mã HTML sau:

```html
<img src="http://bank.com/transfer?to=attacker&amount=10000" />
```

➡️ Trình duyệt vẫn gửi request này kèm theo cookie đăng nhập hợp lệ
➡️ Nếu không có xác thực thêm, tiền sẽ được chuyển!

---

## 🔍 3. Điều kiện để CSRF hoạt động

* Người dùng đã đăng nhập và cookie vẫn còn hiệu lực.
* Server không có biện pháp xác thực lại yêu cầu (CSRF token).
* Trình duyệt tự động gửi cookie khi gọi request từ trang khác.

---

## 🛡 4. Cách phòng chống CSRF

| Biện pháp                                                        | Giải thích                                                                   |
| ---------------------------------------------------------------- | ---------------------------------------------------------------------------- |
| **CSRF Token**                                                   | Gắn mã token ngẫu nhiên vào mỗi form hoặc request, kiểm tra lại phía server. |
| **SameSite Cookie**                                              | Sử dụng flag `SameSite=Strict` hoặc `Lax` để chặn gửi cookie từ bên thứ ba.  |
| **Yêu cầu xác thực lại hành vi nhạy cảm**                        | Ví dụ: yêu cầu nhập lại mật khẩu hoặc xác thực OTP khi chuyển tiền.          |
| **Sử dụng POST thay vì GET cho các hành vi thay đổi trạng thái** | Tránh GET gây tác động hệ thống (như xoá, chuyển tiền...).                   |

---

## ✅ Ví dụ về CSRF Token (HTML)

```html
<form action="/transfer" method="POST">
  <input type="hidden" name="csrf_token" value="abc123xyz">
  <input type="text" name="amount">
  <button type="submit">Chuyển tiền</button>
</form>
```

Phía server sẽ xác minh token `abc123xyz` phải đúng và thuộc session hiện tại.

---

## 🔧 Công cụ kiểm thử CSRF

* **Burp Suite** (có tính năng tìm CSRF)
* OWASP ZAP
* Postman (để gửi request thủ công kiểm tra)
* Các ứng dụng luyện tập: DVWA, WebGoat

---

## 🧠 Tổng kết

* CSRF tấn công vào **niềm tin** của trang web đối với trình duyệt người dùng.
* Dù tấn công không phức tạp như XSS hay SQLi, hậu quả có thể rất nghiêm trọng.
* Luôn xác thực lại các hành động quan trọng, sử dụng CSRF token và cấu hình cookie đúng cách.

---

Bạn có muốn tiếp theo là bài **05. File Inclusion (LFI/RFI)** không?
