Dưới đây là nội dung chi tiết cho bài học:

---

# 03. SQL Injection

**Tấn công SQL Injection – Chèn câu lệnh SQL trái phép**

## 🎯 Mục tiêu

* Hiểu được bản chất của lỗ hổng SQL Injection (SQLi).
* Biết cách khai thác SQLi để trích xuất dữ liệu, bypass đăng nhập...
* Nắm được cách phòng tránh và bảo vệ hệ thống cơ sở dữ liệu.

> Một câu lệnh SQL nhỏ có thể đánh sập cả hệ thống nếu không được kiểm soát đúng cách.

---

## 📌 1. SQL Injection là gì?

SQL Injection là lỗ hổng xảy ra khi ứng dụng web **chèn trực tiếp dữ liệu từ người dùng vào câu lệnh SQL** mà không kiểm soát tốt đầu vào. Kẻ tấn công có thể:

* Truy cập dữ liệu trái phép
* Vượt qua xác thực người dùng
* Thay đổi hoặc xóa dữ liệu
* Điều khiển hệ thống nếu DB được cấu hình sai

---

## 💥 2. Ví dụ đơn giản

### 🔹 Mã giả định trong ứng dụng:

```python
username = input("Tên đăng nhập: ")
password = input("Mật khẩu: ")

query = "SELECT * FROM users WHERE username = '" + username + "' AND password = '" + password + "'"
```

### 🔹 Tấn công:

```
username: admin' --
password: [bỏ trống]
```

Kết quả câu lệnh:

```sql
SELECT * FROM users WHERE username = 'admin' -- ' AND password = ''
```

→ Phần `--` là comment trong SQL ⇒ bỏ qua kiểm tra mật khẩu!

---

## 🔎 3. Các dạng tấn công SQLi

| Loại                  | Mô tả ngắn                                    |
| --------------------- | --------------------------------------------- |
| Classic SQLi          | Chèn câu lệnh SQL đơn giản                    |
| Blind SQLi            | Không thấy phản hồi rõ → dùng đoán/so sánh    |
| Error-based SQLi      | Dựa vào lỗi trả về để khai thác               |
| Union-based SQLi      | Dùng `UNION` để hợp dữ liệu từ bảng khác      |
| Time-based Blind SQLi | Dựa vào độ trễ phản hồi (`SLEEP`) để suy đoán |

---

## 🛠 4. Công cụ hỗ trợ

* **sqlmap** – tool tự động khai thác SQLi
* Burp Suite (Intruder, Repeater)
* sqlninja, Havij (cũ nhưng vẫn có tác dụng)
* Các nền tảng luyện tập: DVWA, bWAPP, WebGoat

---

## 🔐 5. Cách phòng chống

| Kỹ thuật                                  | Mô tả                                               |
| ----------------------------------------- | --------------------------------------------------- |
| Prepared Statements (Parameterized Query) | Không chèn trực tiếp input vào query                |
| ORM (Object Relational Mapping)           | Dùng framework quản lý truy vấn SQL an toàn hơn     |
| Input Validation                          | Kiểm tra và lọc dữ liệu người dùng đầu vào          |
| Least Privilege                           | Không cấp quyền thao tác dữ liệu vượt mức cần thiết |

---

## ✅ Ví dụ an toàn với Prepared Statement (Python + SQLite)

```python
cursor.execute("SELECT * FROM users WHERE username = ? AND password = ?", (username, password))
```

→ Dữ liệu được ràng buộc thay vì nối chuỗi trực tiếp.

---

## 🧠 Tổng kết

* SQLi là một trong những lỗ hổng nguy hiểm nhất (OWASP A03).
* Phòng tránh SQLi là trách nhiệm của lập trình viên và người kiểm thử bảo mật.
* Hãy luôn giả định rằng mọi input đều có thể bị khai thác.

---

Bạn muốn tiếp theo là bài **04. File Inclusion (LFI/RFI)** không?
