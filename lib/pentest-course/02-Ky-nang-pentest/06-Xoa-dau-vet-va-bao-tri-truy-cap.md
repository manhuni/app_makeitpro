Dưới đây là nội dung chi tiết cho bài học:

---

# 06. Xóa dấu vết và Bảo trì truy cập

**Persistence & Covering Tracks**

## 🎯 Mục tiêu

* Hiểu tầm quan trọng của việc duy trì truy cập vào hệ thống sau khi khai thác thành công.
* Biết cách che giấu hoạt động để tránh bị phát hiện.
* Nhận thức rõ các hành vi có thể **vi phạm pháp luật** nếu không được cấp quyền hợp pháp.

> A skilled attacker doesn’t just break in — they stay in, silently. But a professional pentester knows when to stop, and always logs responsibly.

---

## 🔐 1. Duy trì truy cập (Persistence)

Duy trì truy cập là quá trình thiết lập cơ chế để có thể **quay lại hệ thống** mà **không cần khai thác lại từ đầu**.

### 📌 Mục tiêu:

* Tạo cửa hậu (backdoor)
* Thiết lập người dùng/định cấu hình cho truy cập lâu dài
* Đặt cronjob/scheduler để tự động kích hoạt shell

### 🔧 Kỹ thuật phổ biến:

#### Trên Linux:

| Phương pháp           | Mô tả                                 |
| --------------------- | ------------------------------------- |
| SSH key injection     | Thêm key vào `~/.ssh/authorized_keys` |
| Cron job backdoor     | Tạo job gọi reverse shell             |
| Alias hoặc \~/.bashrc | Tự động gọi shell khi user login      |
| Setuid shell          | Tạo file có quyền root                |

#### Trên Windows:

| Phương pháp              | Mô tả                               |
| ------------------------ | ----------------------------------- |
| Registry autorun key     | Shell chạy khi khởi động            |
| Scheduled tasks          | Thiết lập tác vụ chạy shell định kỳ |
| Service hijacking        | Gắn shell vào dịch vụ hệ thống      |
| Add user vào group admin | Tạo user mới có quyền quản trị      |

---

## 🧽 2. Xóa dấu vết (Covering Tracks)

Xóa dấu vết là hành động làm **ẩn sự hiện diện** của bạn trong hệ thống sau khi đã tấn công.

> Trong kiểm thử bảo mật (pentest hợp pháp), xóa dấu vết chỉ được thực hiện **có kiểm soát** để tránh ảnh hưởng đến hệ thống thật.

### 🧹 Hành động thường thấy:

| Hành động                | Công cụ / Mô tả                     |
| ------------------------ | ----------------------------------- |
| Xóa log hệ thống (Linux) | `echo "" > /var/log/*` (nguy hiểm!) |
| Xóa log event (Windows)  | `wevtutil cl <logname>`             |
| Gỡ shell, tệp, user giả  | `rm`, xóa registry, user del        |
| Sử dụng rootkit/trojans  | (Không khuyến khích trong pentest!) |

---

## ⚠️ Lưu ý đạo đức và pháp lý

* Không bao giờ duy trì truy cập hoặc xóa log trên hệ thống thực **khi không được phép**.
* Luôn xin phép rõ ràng nếu có ý định kiểm tra khả năng persistence.
* Ghi lại mọi thay đổi bạn đã thực hiện trong báo cáo để khách hàng có thể kiểm tra, khắc phục.

---

## 🧠 Tổng kết

* **Persistence** giúp đảm bảo bạn có thể tiếp tục kiểm tra sau khi mất kết nối.
* **Covering tracks** chỉ nên dùng để kiểm tra độ phát hiện của hệ thống giám sát (SIEM, IDS/IPS).
* Một pentester chuyên nghiệp **luôn biết khi nào nên dừng lại**.

---

Bạn có muốn mình viết tiếp bài **07. Báo cáo và Đề xuất (Reporting & Recommendations)** không?
